<!DOCTYPE html>
<html lang="en">
<head>
    <title>PI-lot</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="static/pi-lot.css"
           rel="stylesheet"     
          type="text/css">
</head>
<body>
    <header>
        <a href="/index"><h1>PI-lot Message Tracker</h1></a>
    </header>
    <nav id="myLinks">
        <a href="/index">Home</a>
        <a href="/message">Received Messages</a>
        <a href="/sendMessage">Send a message</a>
        <a href="/sentMessagesChart">Sent Messages</a>
    </nav>
</nav>
    <h2>Send a message</h2>
    <main class="form">
        <form action="#" method="POST">
            <fieldset>
                <p>Send a Message</p>
                <p>
                    <textarea id="txtMessage" name="txtMessage" rows="2" cols="40" required></textarea>
                </p>
            </fieldset>
            <fieldset id="sumbit">
                <p>
                    <input type="submit" value="Send">
                </p>    
            </fieldset>
        </form>
        <section class="replied" style="
        background-color: var(--alternate-bg-color);
        padding: 1em;
        text-align: center;
        font-size: 1.3em;">
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
                {% endif %}
            {% endwith %}
        </section>
    </main>

</body>
</html>
<!-- PHP CODE TURN TO PYTHON LINDSAY
     //Database connection
include '../credentials.json';
$credentials = json_decode(file_get_contents("../credentials.json"), true);

$databaseName = 'message_data';
$dsn = 'mysql:host=localhost;dbname='.$databaseName;

$pdo = new PDO($dsn, $credentials['user'], $credentials['password']);
if($pdo) print 'Connection complete';

    //initialize variable
    $message = '';

    function getData($field) {
        if(!isset($_POST[$field])) {
            $data = " ";
        } else {
            $data = trim($_POST[$field]);
            $data = htmlspecialchars($data);
        }
        return $data;
    }

    function verifyAlphaNum($testString) {
        return (preg_match ("/^([[:alnum:]]|-|\.| |\'|&|;|#)+$/", $testString));
    }

    if($_SERVER["REQUEST_METHOD"] == 'POST'){

        //input sanitization and validation
        $message = getData($message);

        $dataIsGood = true;

        if($message == ''){
            $errorMessage .= '<p class="mistake">Please enter a message.</p>';
            $dataIsGood = false;
        } elseif(!verifyAlphaNum($message)){
            $errorMessage .= '<p class="mistake">Your message contains invalid characters.</p>';
            $dataIsGood = false;
        }

        //save input
        if($dataIsGood){
            $sql = 'INSERT INTO message_data (timestamp, fldMessage, fldSource, fldDestination)';
            $sql .= " VALUES (?, ?, ?, ?)";

            $currTime = time();
            $formattedDateTime = date("d/m/Y H:i", $currTime);

            $data = array($formattedDateTime, $message, 'HQ', 'Raspberry Pi');

            try{
                $statement = $pdo->prepare($sql);
                if($statement->execute($data)){
                    $message = '<h2>Thank you</h2>';
                    $message .= '<p>Your message was successfully saved.</p>';
                } else {
                    $message = '<p>Your message was NOT successfully saved.</p>';
                    $dataIsGood = false;
                }
            } catch(PDOException $e) {
                $message = '<p>Server error. We did not recieve your message. Please contact Lindsay at lhall11@uvm.edu</p>';
            }
        }
    } -->